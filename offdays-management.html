<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFF Days Management - Halagel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --dark: #1f2937;
            --light: #f8fafc;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .nav a {
            padding: 0.75rem 1.5rem;
            background: white;
            border-radius: 8px;
            text-decoration: none;
            color: var(--gray-600);
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav a.active {
            background: var(--warning);
            color: white;
        }
        
        .form-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
        }
        
        .form-card h2 {
            color: var(--dark);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .info-box {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .info-box h3 {
            color: #1e40af;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .info-box p {
            color: #374151;
            font-size: 0.9rem;
        }
        
        .calendar-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn.primary {
            background: var(--primary);
            color: white;
        }
        
        .btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .btn.success {
            background: var(--success);
            color: white;
        }
        
        .btn.success:hover {
            background: #047857;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--gray-200);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
        }
        
        .calendar-day {
            background: white;
            padding: 1rem;
            min-height: 100px;
            border: 1px solid var(--gray-200);
        }
        
        .calendar-day.off {
            background: #fef3c7;
        }
        
        .calendar-day.working {
            background: #d1fae5;
        }
        
        .day-number {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .day-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
        }
        
        .status-off {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-working {
            background: #d1fae5;
            color: #059669;
        }
        
        .day-actions {
            margin-top: 0.5rem;
        }
        
        .toggle-btn {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            background: white;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .toggle-btn:hover {
            background: var(--gray-100);
        }
        
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-weight: 500;
            display: none;
            border-left: 4px solid;
        }
        
        .message.success {
            background: #f0fdf4;
            color: #166534;
            border-left-color: #22c55e;
            display: block;
        }
        
        .message.error {
            background: #fef2f2;
            color: #991b1b;
            border-left-color: #ef4444;
            display: block;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="index.html">
                <i class="fas fa-chart-line"></i>
                Dashboard
            </a>
            <a href="plan-entry.html">
                <i class="fas fa-calendar-plus"></i>
                Production Planning
            </a>
            <a href="actual-entry.html">
                <i class="fas fa-clipboard-check"></i>
                Actual Production
            </a>
            <a href="offdays-management.html" class="active">
                <i class="fas fa-calendar-times"></i>
                OFF Days Management
            </a>
        </div>
        
        <div class="form-card">
            <h2><i class="fas fa-calendar-times"></i> OFF Days Management</h2>
            
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> Information</h3>
                <p>By default, Fridays and Saturdays are OFF days. Use this panel to override specific dates as WORKING days when production is needed.</p>
            </div>
            
            <div class="calendar-controls">
                <div class="month-selector">
                    <button class="btn" onclick="changeMonth(-1)">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <h3 id="currentMonth">November 2025</h3>
                    <button class="btn" onclick="changeMonth(1)">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <button class="btn success" onclick="saveOffDays()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
            
            <div id="calendar" class="calendar-grid">
                <!-- Calendar will be generated by JavaScript -->
            </div>
            
            <div id="message" class="message"></div>
        </div>
    </div>

    <script>
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbz86-TUlAp9or0OyA1-JuWgRTOj0hlPln6tTedJgLy9q_S3F4-4a9XFjNSgQ3tkgUz5/exec';
        
        let currentDate = new Date('2025-11-01');
        let offDaysData = {};
        
        document.addEventListener('DOMContentLoaded', function() {
            loadOffDaysData();
        });
        
        function loadOffDaysData() {
            fetch(`${GOOGLE_SHEET_URL}?action=getOffDays`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Convert array to object for easier lookup
                        data.offDays.forEach(offDay => {
                            offDaysData[offDay[0]] = offDay[1];
                        });
                        renderCalendar();
                    } else {
                        showMessage(data.message, 'error');
                    }
                })
                .catch(error => {
                    showMessage('Error loading OFF days data: ' + error.message, 'error');
                });
        }
        
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYear = document.getElementById('currentMonth');
            
            // Set month/year header
            monthYear.textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });
            
            // Clear calendar
            calendar.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            // Add empty cells for days before first day of month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendar.appendChild(emptyDay);
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                const dateStr = formatDate(date);
                const dayOfWeek = date.getDay();
                const dayName = days[dayOfWeek];
                
                // Check if it's OFF day
                const isDefaultOffDay = ['Fri', 'Sat'].includes(dayName);
                const customStatus = offDaysData[dateStr];
                const isOffDay = customStatus ? customStatus === 'OFF' : isDefaultOffDay;
                
                const dayElement = document.createElement('div');
                dayElement.className = `calendar-day ${isOffDay ? 'off' : 'working'}`;
                
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                    <div class="day-status ${isOffDay ? 'status-off' : 'status-working'}">
                        ${isOffDay ? 'OFF DAY' : 'WORKING DAY'}
                    </div>
                    <div class="day-actions">
                        <button class="toggle-btn" onclick="toggleDay('${dateStr}')">
                            Set as ${isOffDay ? 'WORKING' : 'OFF'}
                        </button>
                    </div>
                `;
                
                calendar.appendChild(dayElement);
            }
        }
        
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }
        
        function toggleDay(dateStr) {
            const currentStatus = offDaysData[dateStr];
            const dayOfWeek = new Date(dateStr).getDay();
            const isDefaultOffDay = [5, 6].includes(dayOfWeek); // Friday=5, Saturday=6
            
            if (currentStatus) {
                // Toggle existing custom status
                offDaysData[dateStr] = currentStatus === 'OFF' ? 'WORKING' : 'OFF';
            } else {
                // Set opposite of default
                offDaysData[dateStr] = isDefaultOffDay ? 'WORKING' : 'OFF';
            }
            
            renderCalendar();
            showMessage('Changes made. Remember to save!', 'success');
        }
        
        function saveOffDays() {
            const offDaysArray = Object.keys(offDaysData).map(date => ({
                date: date,
                status: offDaysData[date]
            }));
            
            const formData = new URLSearchParams();
            formData.append('action', 'updateOffDays');
            formData.append('offDays', JSON.stringify(offDaysArray));
            
            fetch(GOOGLE_SHEET_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                showMessage(data.message, data.status);
            })
            .catch(error => {
                showMessage('Error saving OFF days: ' + error.message, 'error');
            });
        }
        
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
        
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
